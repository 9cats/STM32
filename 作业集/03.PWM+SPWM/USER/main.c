#include "pwm.h"
#include "delay.h"
#include "usart.h"

/********************************************************************
** ä½œè€…: 9catsðŸ§
** åˆ›å»ºæ—¶é—´: ðŸ“…2020-11-24 ðŸ•‘20:00
** é€‚ç”¨çŽ¯å¢ƒ: ALIENTEK STM32F407å¼€å‘æ¿
** ðŸ“•é¢˜ç›®åŸºæœ¬è¦æ±‚ï¼š
**ï¼ˆ1ï¼‰åˆ©ç”¨å®šæ—¶å™¨è¾“å‡ºä¸€è·¯é¢‘çŽ‡1KHZçš„PWMæ³¢ã€‚
**ï¼ˆ2ï¼‰åˆ©ç”¨å¤–éƒ¨ä¸­æ–­æŽ§åˆ¶æŒ‰é”®1æ”¹å˜PWMæ³¢çš„å ç©ºæ¯”ï¼Œæ­¥è¿›ä¸º10ï¼…ã€‚
**ï¼ˆ3ï¼‰åˆ©ç”¨å¤–éƒ¨ä¸­æ–­æŽ§åˆ¶æŒ‰é”®2å¯æŒç»­æ€§åœ°æ”¹å˜PWMæ³¢çš„å ç©ºæ¯”ï¼Œå†æ¬¡æŒ‰ä¸‹æš‚åœå ç©ºæ¯”çš„æ”¹å˜ã€‚
** ðŸ“—å‘æŒ¥éƒ¨åˆ†ï¼š
**ï¼ˆ1ï¼‰åˆ©ç”¨å¤–éƒ¨ä¸­æ–­æŽ§åˆ¶æŒ‰é”®3æ”¹å˜PWMæ³¢çš„é¢‘çŽ‡ï¼Œæ­¥è¿›ä¸º1KHZã€‚ï¼ˆå ç©ºæ¯”è‡³å°‘é€’å‡å››æ¬¡ï¼‰
**ï¼ˆ2ï¼‰å†ç”Ÿæˆä¸€è·¯1KHzçš„PWMæ³¢ï¼Œåˆ©ç”¨å¤–éƒ¨ä¸­æ–­æŽ§åˆ¶æŒ‰é”®4å¯æŒç»­æ€§åœ°æ”¹å˜å…¶ç›¸ä½ï¼Œå†æ¬¡æŒ‰ä¸‹æš‚åœç›¸ä½çš„æ”¹å˜ã€‚
**ï¼ˆ3ï¼‰åˆ©ç”¨å®šæ—¶å™¨è¾“å‡ºSPWMï¼Œé¢‘çŽ‡ä¸º50Hzï¼Œå¹¶è‡ªåˆ¶ç®€æ˜“æ»¤æ³¢ç”µè·¯éªŒè¯è¾“å‡ºç»“æžœã€‚
** å¤‡æ³¨: ðŸˆš
*********************************************************************/

int main(void)
{
	u16 led0pwmval = 0;
	u8 dir = 1;
	NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2); //è®¾ç½®ç³»ç»Ÿä¸­æ–­ä¼˜å…ˆçº§åˆ†ç»„2
	delay_init(168);								//åˆå§‹åŒ–å»¶æ—¶å‡½æ•°
	uart_init(115200);								//åˆå§‹åŒ–ä¸²å£æ³¢ç‰¹çŽ‡ä¸º115200
	TIM2_PWM_Init(500 - 1, 84 - 1);					//84M/84=1Mhzçš„è®¡æ•°é¢‘çŽ‡,é‡è£…è½½å€¼500ï¼Œæ‰€ä»¥PWMé¢‘çŽ‡ä¸º 1M/500=2Khz.
	while (1)										//å®žçŽ°æ¯”è¾ƒå€¼ä»Ž0-300é€’å¢žï¼Œåˆ°300åŽä»Ž300-0é€’å‡ï¼Œå¾ªçŽ¯
	{}
}

// /*------------------------------------------------------*\
// *|				    ã€è·‘é©¬ã€‘
// *|è¾“å…¥:æ— 
// *|è¿”å›ž:æ— 
// *|æè¿°: ðŸŽÎµ=Îµ=Îµ=
// \*------------------------------------------------------*/
// void run_hrose(void) {
// 	/* è·‘é©¬çŠ¶æ€,1è¡¨ç¤ºè·‘é©¬ã€iä¸ºå¾ªçŽ¯å˜é‡ */
// 	static u8 Run_State=1, i = 0;
// 	if(Run_State_change_flag) {
// 		Run_State = !Run_State;
// 		Run_State_change_flag = 0;
// 	}
// 	switch(i++%3) {
// 		case 0:
// 			LED0 = 0 & Run_State;
// 			LED1 = 1 & Run_State;
// 			LED2 = 1 & Run_State;
// 			break;
// 		case 1:
// 			LED0 = 1 & Run_State;
// 			LED1 = 0 & Run_State;
// 			LED2 = 1 & Run_State;
// 			break;
// 		case 2:
// 			LED0 = 1 & Run_State;
// 			LED1 = 1 & Run_State;
// 			LED2 = 0 & Run_State;
// 			break;
// 	}
// //	LED0 = 1, LED1 = 1, LED2 = 1;
// }

// /*------------------------------------------------------*\
// *|				    ã€è¾“å‡ºä¿¡å·ã€‘
// *|è¾“å…¥:æ— 
// *|è¿”å›ž:æ— 
// *|æè¿°:æŽ§åˆ¶C0,C2ä¸¤ä¸ªè¾“å‡º
// \*------------------------------------------------------*/
// void output(void) {
// 	/* é¢‘çŽ‡æ”¹å˜æ ‡è®°å’ŒçŠ¶æ€æ”¹å˜æ ‡è®° */
// 	static u32 output1_cycle = 100;				//é»˜è®¤å‘¨æœŸæ˜¯1s
// 	static double output1_proportion = 1;        //é»˜è®¤å ç©ºæ¯”
// 	static u32 output0_prograss = 0, output1_prograss = 0, output2_prograss;	//è®°å½•å½“å‰è¿›åº¦

// 	/* è¿›åº¦åˆ†åˆ«å¢žåŠ  */
// 	output0_prograss = output0_prograss % (      100     * 5) + 1;
// 	output1_prograss = output1_prograss % (output1_cycle * 5) + 1;
// 	output2_prograss = output2_prograss % (      100     * 5) + 1;

// 	/* æŒ‰ä¸‹KEY1æ”¹å˜é¢‘çŽ‡ */
// 	if(key == KEY1_PRES) {
// 		/* å‘¨æœŸå˜åŒ–ä¸ºï¼š100 140 180 220 20 60 -> 100*/
// 		output1_cycle = (output1_cycle > 200)? 20 : output1_cycle+40;
// 		output0_prograss = 0;
// 		output1_prograss = 0;
// 	}
// 	/* æŒ‰ä¸‹KEY2æ”¹å˜å ç©º */
// 	if(key == KEY2_PRES) {
// 		/* å ç©ºæ¯”å¼ºåº¦å˜åŒ–ä¸ºï¼š1 0.8 0.6 0.4 0.2 -> 1 */
// 		output1_proportion = output1_proportion - 0.2 ? output1_proportion-0.2: 1;
// 		output0_prograss = 0;
// 		output1_prograss = 0;
// 	}

// 	/* outputx_cycleå†³å®šé¢‘çŽ‡ï¼Œoutputx_proportionå†³å®šå ç©ºæ¯” */
// 	/* å ç©ºæ¯”å˜åŒ–ä¸º 90% 70% 50% 30% 10% */
// 	if(output1_prograss % output1_cycle > (90 - output1_prograss/output1_cycle*20)*output1_proportion)
// 		 OUTPUT1 = 0;
// 	else OUTPUT1 = 1;
// 	if(output0_prograss %      100      > (90 - output0_prograss/     100     *20)*       1          )
// 		 OUTPUT0 = 0;
// 	else OUTPUT0 = 1;
// 	if(output2_prograss %      100      > (50                                     )*       1          )
// 		 OUTPUT2 = 0;
// 	else OUTPUT2 = 1;

// }
